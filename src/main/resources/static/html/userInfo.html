<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript" src="../js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../layui/layui.js"></script>
<link type="text/css" rel="stylesheet" href="../layui/css/layui.css">
<link type="text/css" rel="stylesheet" href="../css/myBlog.css">
</head>
<body>
	<div class="layui-layout layui-layout-admin">
		<!-- 头部 -->
		<div class="layui-header layui-bg-cyan">
			<div id="logo" class="layui-logo">MyBlog</div>
			<!-- 头部列表区域 -->
			<ul class="layui-nav layui-layout-left layui-bg-cyan">
				<li class="layui-nav-item"><a
					href="http://localhost:8080/html/homePage.html">所有博客</a></li>
				<li class="layui-nav-item"><a
					href="http://localhost:8080/html/myArticleListPage.html">个人博客</a></li>
				<li class="layui-nav-item"><a
					href="http://localhost:8080/html/writeArticle.html">写博客</a></li>
				<li class="layui-nav-item"><a href="#">待开发</a></li>
			</ul>
			<ul class="layui-nav layui-layout-right layui-bg-cyan">
				<li class="layui-nav-item"><a href="">个人中心<span
						class="layui-badge-dot"></span></a></li>
				<li class="layui-nav-item" lay-unselect=""><a
					href="javascript:;"><img src="http://t.cn/RCzsdCq"
						class="layui-nav-img">我</a>
					<dl class="layui-nav-child">
						<dd>
							<a id="changePersonalInfo" href="#">修改信息</a>
						</dd>
						<!-- <dd><a href="javascript:;">安全管理</a></dd> -->
						<dd>
							<a id="loginOutLink" href="#">退出登录</a>
						</dd>
					</dl></li>
			</ul>
		</div>

		<!-- 内容部 -->
		<div id="contenter" class="layui-body layui-bg-gray" style="left: 0;background-image: url('../lib/wenli1.jpg');background-repeat: no-repeat;background-size: cover;">
			<form id="personInfoForm" class="layui-form" action="" target="nm_iframe"
				style="background-color: white;margin: 100px auto;width: 600px;height: 600px; border-radius: 16px;border:3px #888887 solid;box-shadow: 10px 10px 5px #888888; ">
				
				<div class="layui-form-item" style="margin-top: 25px;padding-top: 25px;">
					<label class="layui-form-label">账号</label>
					<div class="layui-input-block" style="padding-left: 30px;">
						<input id="userID" type="text" name="userID" disabled
							placeholder="请输新的账号" style="background-color: #e2e2e2;width:350px;text-align: center;"
							class="layui-input">
					</div>
				</div>

				<div class="layui-form-item" style="margin-top: 25px;">
					<label class="layui-form-label">昵称</label>
					<div class="layui-input-block" style="padding-left: 30px;">
						<input id="userName" type="text" name="userName" required
							lay-verify="required" placeholder="请输新昵称" autocomplete="off"
							class="layui-input" style="width:350px;text-align: center">
					</div>
				</div>
				<div class="layui-form-item" style="margin-top: 25px;">
					<label class="layui-form-label">手机</label>
					<div class="layui-input-block" style="padding-left: 30px;">
						<input id="userMobile" type="text" name="userMobile"
							placeholder="请输新手机号" autocomplete="off" class="layui-input" style="width:350px;text-align: center" lay-verify="phone">
					</div>
				</div>
				<div class="layui-form-item" style="margin-top: 25px;">
					<label class="layui-form-label">e-mail</label>
					<div class="layui-input-block" style="padding-left: 30px;">
						<input id="userEmail" type="text" name="userEmail"
							placeholder="请输新昵称" autocomplete="off" class="layui-input" style="width:350px;text-align: center" lay-verify="email">
					</div>
				</div>
				<div class="layui-form-item" style="margin-top: 25px;">
					<label class="layui-form-label">地址</label>
					<div class="layui-input-block" style="padding-left: 30px;">
						<input id="userAddress" type="text" name="userAddress"
							placeholder="请输新地址" autocomplete="off" class="layui-input"style="width:350px;text-align: center">
					</div>
				</div>

				<div class="layui-form-item" style="margin-top: 25px;">
					<label class="layui-form-label">生日</label>
					<div class="layui-input-block" style="padding-left: 30px;">
						<input id="userBirthday" type="text" name="userBirthday"
							placeholder="请输入出生日期" autocomplete="off" class="layui-input"style="width:350px;text-align: center">
					</div>
				</div>

				<div class="layui-form-item" style="margin-top: 25px;">
					<label class="layui-form-label">性别</label>
					<div class="layui-input-block" style="margin-top: 25px;margin-left: 240px;">
						<input id="userGenderM" type="radio" name="sex" value="男"
							title="男" checked="checked"> <input id="userGenderF" type="radio"
							name="sex" value="女" title="女" >
					</div>
				</div>

				<div class="layui-form-item" style="margin-top: 25px;">
					<div class="layui-input-block" style="padding-left: 30px;">
						<button id="savePersonalInfo" class="layui-btn my-btn-primary"
							lay-submit lay-filter="formDemo">立即保存</button>
						<button id="backHomePage" class="layui-btn my-btn-primary"style="margin-left: 160px;">返回主页</button>
					</div>
				</div>
			</form>

			<!-- 用来处理form提交后的刷新 -->
			<iframe id="id_iframe" name="nm_iframe" style="display: none;"></iframe>


		</div>

		<!-- 底部 -->
		<div class="layui-footer" style="left: 0; background-color: #2F4056">
			<!-- 底部固定区域 -->
			<div style="margin-left: 20%;">
				<label style="color: white;"> <a href="#"
					style="margin-left: 370px; color: white;">© 2018 myBlog.com</a>
					&nbsp; <a href="#" style="color: white;">微信公众号</a> &nbsp; <a
					href="#" style="color: white;">案例</a> &nbsp; <a href="#"
					style="color: white;">支持</a> &nbsp; <a href="#"
					style="color: white;">联系</a> &nbsp; <a href="https://github.com/"
					target="_blank" style="color: white;">GitHub</a>
				</label>
			</div>
		</div>
	</div>

	<script>
		/* layui的JavaScript代码区域 */
		layui.use([ 'laydate', 'form', 'layer', 'element' ],function() {
			var laydate = layui.laydate, form = layui.form, layer = layui.layer, element = layui.element;
			//执行一个laydate实例
			laydate.render({
				elem : '#userBirthday' //指定元素
			});
		});

		/*-------------------------------------------------------------------分界线-------------------------------------------------------------------------------------
		 ---------------------------------------------------------------------------------------------------------------------------------------------------------------
		 ----*/

		/* 个人js区域 */
		$(document).ready(function() {
			getUserInfo1(); //调用显示个人信息的方法
		});

		/* 页面初始显示个人信息的方法 */
		function getUserInfo1() {
			$.ajax({
				type : "GET",
				url : "http://localhost:8080/getUserInfo",
				success : function(data) {
					//console.log(data);
					//console.log(data.userID);
					document.getElementById("personInfoForm").reset();  //form恢复默认值(清理缓存,解决性别单选框刷新不变问题)
					$("#userID").attr("value", data.userID)
					$("#userName").attr("value", data.userName);
					$("#userMobile").attr("value", data.userMobile);
					$("#userEmail").attr("value", data.userEmail);
					$("#userAddress").attr("value", data.userAddress);
					$("#userBirthday").attr("value", data.userBirthday);
					var userGender = data.userGender;
					if (userGender == "男") {
						$("#userGenderM").attr("checked", "checked");
						$("#userGenderF").removeAttr("checked");
						//console.log(data.userGender);
					} else if (userGender == "女") {
						$("#userGenderF").attr("checked", "checked");
						$("#userGenderM").removeAttr("checked");
					} else {
						$("#userGenderF").removeAttr("checked");
						$("#userGenderM").removeAttr("checked");
					}
				}
			});
		};

		/* 点击保存按钮,保存个人信息 */
		$("#savePersonalInfo").click(function() {
			var userName = document.getElementById("userName").value; //获取相应输入框内的值
			var userMobile = document.getElementById("userMobile").value;
			var CK_mobile = /^((13[0-9])|(14[5,7,9])|(15[^4])|(18[0-9])|(17[0,1,3,5,6,7,8]))\d{8}$/;
			
			var userEmail = document.getElementById("userEmail").value;
			var CK_email = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
			/* if(!ema.test(userEmail)){
				alert("cao");
			} */
			var userAddress = document.getElementById("userAddress").value;
			var userBirthday = document.getElementById("userBirthday").value;
			var userGender = $("input[name='sex']:checked").val(); //获取单选框选中为checked的值
			//console.log(userGender);
			if(!CK_email.test(userEmail)|!CK_mobile.test(userMobile)){
			
			}else{
				$.ajax({
					type : "GET",
					url : "http://localhost:8080/updateUserInfo",
					data : "username=" + userName + "&usermobile="+ userMobile + "&useremail="+ userEmail + "&useraddress="+ userAddress + "&usergender="+ userGender + "&userbirthday="+ userBirthday,
					success : function() {
						layer.msg('修改成功');
					},
				});
			}
			
		});

		/* 返回主页homePage按钮 */
		$("#backHomePage").click(function() {
			location.href = "/html/homePage.html";
		});

		/* 退出登录 */
		$("#loginOutLink").click(function() {
			$.ajax({
				type : "GET",
				url : "http://localhost:8080/loginOut",
				success : function() {
					location.href = "/html/mainPage.html";
				}
			});
		});

		/* 跳转修改信息页面 */
		$("#changePersonalInfo").click(function() {
			location.href = "/html/userInfo.html"
		});

		//头部logo点击事件
		$("#logo").click(function() {
			location.href = "/html/homePage.html";
		});
	</script>
</body>
</html>